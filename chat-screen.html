<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat App | Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex h-screen flex-col">
      <!-- Back Button + Chat Title -->
       <div class="flex items-center justify-between mb-4">
  <h2 class="text-xl font-bold">Chats</h2>
  <button id="themeBtn" class="bg-gray-300 px-3 py-2 rounded-lg hover:bg-gray-400">Toggle Dark Mode</button>
</div>


  <div class="p-4 bg-gray-100 flex items-center">
    <button id="backBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-lg mr-4">
      ‚Üê Back
    </button>
    <h2 class="text-lg font-semibold" id="chatWith"></h2>
  </div>
  <div class="flex-1 p-6 overflow-y-auto messages bg-white m-4 rounded-lg shadow-md">
    <!-- Messages will appear here -->
  </div>

  <div class="p-4 flex m-4 bg-white rounded-lg shadow-md">
    <input type="text" id="msgInput" placeholder="Type a message..." class="flex-1 p-3 border rounded-l-lg">
    <button id="sendBtn" class="bg-indigo-600 text-white px-6 rounded-r-lg hover:bg-indigo-700 transition">Send</button>
  </div>
    


<script>
const messagesDiv = document.querySelector('.messages');
const sendBtn = document.getElementById('sendBtn');
const msgInput = document.getElementById('msgInput');
const backBtn = document.getElementById('backBtn');
const chatWith = document.getElementById('chatWith');

// Get contact name from URL
const urlParams = new URLSearchParams(window.location.search);
const userName = urlParams.get('user');
chatWith.textContent = "Chatting with " + userName;

// Back button redirects to chat list
backBtn.addEventListener('click', () => {
  window.location.href = 'chat-list.html';
});

// Load previous messages from localStorage
window.addEventListener('load', () => {
  let savedMessages = JSON.parse(localStorage.getItem(userName)) || [];
  savedMessages.forEach(text => {
    const msg = document.createElement('div');
    // Decide if message is sent or received
    const isReply = text.startsWith("Reply:");
    msg.className = isReply ? 'text-left mb-4' : 'text-right mb-4';
    msg.innerHTML = `<p class="${isReply ? 'bg-gray-200' : 'bg-indigo-600 text-white'} inline-block p-3 rounded-lg">${text.replace("Reply:","")}</p>`;
    messagesDiv.appendChild(msg);
  });
});

// Send message dynamically
sendBtn.addEventListener('click', () => {
  if(msgInput.value.trim() !== ''){
    const text = msgInput.value;

    // Show message
    const msg = document.createElement('div');
    msg.className = 'text-right mb-4';
    msg.innerHTML = `<p class="bg-indigo-600 text-white inline-block p-3 rounded-lg">${text}</p>`;
    messagesDiv.appendChild(msg);

    // Save in localStorage
    let messages = JSON.parse(localStorage.getItem(userName)) || [];
    messages.push(text);
    localStorage.setItem(userName, JSON.stringify(messages));

    msgInput.value = '';
    messagesDiv.scrollTop = messagesDiv.scrollHeight;

    // Simulate a reply after 1 second
    setTimeout(() => {
      const reply = document.createElement('div');
      reply.className = 'text-left mb-4';
      reply.innerHTML = `<p class="bg-gray-200 inline-block p-3 rounded-lg">Hello! This is a reply from ${userName}.</p>`;
      messagesDiv.appendChild(reply);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;

      // Save reply in localStorage
      messages.push("Reply: Hello! This is a reply from " + userName + ".");
      localStorage.setItem(userName, JSON.stringify(messages));
    }, 1000);
  }
});

// Typing indicator
msgInput.addEventListener('input', () => {
  chatWith.textContent = `Chatting with ${userName} (typing...)`;
});
msgInput.addEventListener('blur', () => {
  chatWith.textContent = `Chatting with ${userName}`;
});
const themeBtn = document.getElementById('themeBtn');
themeBtn.addEventListener('click', () => {
  document.body.classList.toggle('dark'); // toggles dark mode
});

</script>


</body>
</html>
